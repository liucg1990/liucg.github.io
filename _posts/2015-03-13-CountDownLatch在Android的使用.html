---
layout: default
title: CountDownLatch在Android的使用
---
<a href="http://liucg1990.github.io/">返回</a>
<h2>{{ page.title }}</h2>
<p>在实际开发中，我们经常会遇到这样一个场景：在主线程新开几个子线程去获取数据，等几个子线程的数据都获取完了才继续主线程的操作</p>
<p>直接上代码</p>
<code>
	<pre>
	public void start() {

        int size = 10;
        CountDownLatch countDownLatch = new CountDownLatch(size);
        Log.e("liucg", "start");
        for (int i = 0; i < size; i++) {
            new Thread(new myRunnable(i, countDownLatch)).start();
        }
        try {
            countDownLatch.await();
            Log.e("liucg", "ALL Runnables done");
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    private class myRunnable implements Runnable {

        private int mI;

        private CountDownLatch mCountDownLatch;

        public myRunnable(int i, CountDownLatch countDownLatch) {
            mI = i;
            mCountDownLatch = countDownLatch;
        }

        @Override
        public void run() {
            try {
                double delay = Math.random() * 10000;
                Thread.sleep((long) delay);
                Log.e("liucg", "run : " + mI + "--delay : " + delay);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            mCountDownLatch.countDown();
        }

    }
    </pre>
</code>
<p>{{ page.date | date_to_string }}</p>